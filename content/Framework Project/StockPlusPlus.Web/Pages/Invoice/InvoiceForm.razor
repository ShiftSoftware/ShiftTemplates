@attribute [Route($"/{nameof(InvoiceForm)}/{{Key?}}")]

@using ShiftSoftware.ShiftEntity.Model.Dtos
@using StockPlusPlus.Shared.DTOs.Product
@using StockPlusPlus.Shared.DTOs

@using Pages.ProductBrand
@using Pages.ProductCategory
@using Pages.Country

@inherits ShiftForm<InvoiceForm, InvoiceDTO>
@inject ODataQuery odataQuery

<ShiftEntityForm @bind-Mode="Mode"
                 @bind-Value="TheItem"
                 @ref="FormContainer"
                 Endpoint="Invoice"
                 Title="Invoice"
                 TypeAuthAction="StockPlusPlus.Shared.ActionTrees.StockPlusPlusActionTree.Product"
                 AllowClone
                 @bind-Key="@Key">

    <MudTextFieldExtended OnlyValidateIfDirty="true"
                          Label="Manual Reference"
                          @bind-Value="TheItem.ManualReference"
                          For="@(() => TheItem.ManualReference)" />

    <ShiftDateTimePicker Clearable
                         Label="DateTime Picker"
                         Adornment="Adornment.End"
                         OnAdornmentClick="() => Console.WriteLine(234)"
                         @bind-DateTimeOffset="TheItem.InvoiceDate"
                         For="() => TheItem.InvoiceDate" />

    <MultiItemField Min="5" Max="3" Title="Lines"  @bind-Value="TheItem.InvoiceLines" T="List<InvoiceLineDTO>" TItem="InvoiceLineDTO">
        
        <FieldHeader Context="Field">
            <MudGrid Spacing="3" Style="align-items: baseline;">
                <MudItem lg="4" md="4" sm="4" xs="4">
                    <MudText Class="mud-text-with-border pb-3" Typo="Typo.subtitle2">Product</MudText>
                </MudItem>

                <MudItem lg="4" md="4" sm="4" xs="4">
                    <MudText Class="mud-text-with-border pb-3" Typo="Typo.subtitle2">Description</MudText>
                </MudItem>

                <MudItem lg="4" md="4" sm="4" xs="4">
                    <MudText Class="mud-text-with-border pb-3" Typo="Typo.subtitle2">Price</MudText>
                </MudItem>
            </MudGrid>
        </FieldHeader>

        <FieldBody Context="Item">
            <MudGrid Spacing="3" Style="align-items: baseline;">

                <MudItem Class="pt-1 pb-1" lg="4" md="4" sm="4" xs="4">
                    <ShiftAutocomplete Label="Product"
                                       @bind-Value="Item.Product"
                                       TEntitySet="ProductListDTO"
                                       EntitySet="Product"
                                       For="() => Item.Product" />
                </MudItem>

                <MudItem Class="pt-1 pb-1" lg="4" md="4" sm="4" xs="4">
                    <MudTextFieldExtended Label="Description"
                                          OnlyValidateIfDirty="false"
                                          @bind-Value="Item.Description"
                                          For="() => Item.Description" />
                </MudItem>

                <MudItem Class="pt-1 pb-1" lg="4" md="4" sm="4" xs="4">
                    <MudNumericFieldExtended Label="Price"
                                             OnlyValidateIfDirty="false"
                                             @bind-Value="Item.Price"
                                             For="() => Item.Price" />
                </MudItem>
            </MudGrid>
        </FieldBody>
  
    </MultiItemField>
</ShiftEntityForm>